############################################################
# 1) AUTHENTICATIE — JWT ophalen (PASSWORD GRANT)
############################################################
POST http://localhost:8180/realms/moko/protocol/openid-connect/token
Content-Type: application/x-www-form-urlencoded

grant_type = password &
client_id = user-service &
client_secret = ZmXSd2mIzB6hsLrybeD3gH0c11vPwrej &
username = jan &
password = loginjan &
scope = openid

> {%
    client.global.set("jan_token", response.body.access_token);
%}

###
POST http://localhost:8180/realms/moko/protocol/openid-connect/token
Content-Type: application/x-www-form-urlencoded

grant_type = password &
client_id = user-service &
client_secret = ZmXSd2mIzB6hsLrybeD3gH0c11vPwrej &
username = piet &
password = loginpiet &
scope = openid

> {%
    client.global.set("piet_token", response.body.access_token);
%}



############################################################
# 2) USER-SERVICE TESTS — PROFIEL OPHALEN
############################################################

### Get Jan profile (me)
GET http://localhost:8080/api/profiles/me
Authorization: Bearer {{jan_token}}

> {%
    client.global.set("jan_id", response.body.id);
%}

### Get Piet profile (me)
GET http://localhost:8080/api/profiles/me
Authorization: Bearer {{piet_token}}

> {%
    client.global.set("piet_id", response.body.id);
%}

### Get Jan by username
GET http://localhost:8080/api/profiles/find/jan
Authorization: Bearer {{piet_token}}

### Get Piet by username
GET http://localhost:8080/api/profiles/find/piet
Authorization: Bearer {{jan_token}}



############################################################
# 3) SOCIAL-SERVICE — SEND FRIEND REQUEST
############################################################

### Jan → Piet: send friend request
POST http://localhost:8081/api/friends/add
Authorization: Bearer {{jan_token}}
Content-Type: application/json

{
  "username": "piet"
}



############################################################
# 4) SOCIAL-SERVICE — OVERVIEW REQUESTS
############################################################

### Jan sees outgoing
GET http://localhost:8081/api/friends
Authorization: Bearer {{jan_token}}

### Piet sees incoming
GET http://localhost:8081/api/friends
Authorization: Bearer {{piet_token}}



############################################################
# 5) Piet ACCEPTS friend request
############################################################

POST http://localhost:8081/api/friends/accept/{{jan_id}}
Authorization: Bearer {{piet_token}}



############################################################
# 6) Both should now be FRIENDS
############################################################

### Jan friend list
GET http://localhost:8081/api/friends
Authorization: Bearer {{jan_token}}

### Piet friend list
GET http://localhost:8081/api/friends
Authorization: Bearer {{piet_token}}



############################################################
# 7) TEST REJECT FLOW
############################################################

### First remove friendship (Jan removes Piet)
DELETE http://localhost:8081/api/friends/remove/{{piet_id}}
Authorization: Bearer {{jan_token}}

### Jan sends new request
POST http://localhost:8081/api/friends/add
Authorization: Bearer {{jan_token}}
Content-Type: application/json

{
  "username": "piet"
}

### Piet rejects the request
POST http://localhost:8081/api/friends/reject/{{jan_id}}
Authorization: Bearer {{piet_token}}



############################################################
# 8) TEST CANCEL FLOW
############################################################

### Jan sends again
POST http://localhost:8081/api/friends/add
Authorization: Bearer {{jan_token}}
Content-Type: application/json

{
  "username": "piet"
}

### Jan cancels his own request
POST http://localhost:8081/api/friends/cancel/{{piet_id}}
Authorization: Bearer {{jan_token}}



############################################################
# 9) FINAL — CLEANUP CHECK
############################################################

### Jan overview
GET http://localhost:8081/api/friends
Authorization: Bearer {{jan_token}}

### Piet overview
GET http://localhost:8081/api/friends
Authorization: Bearer {{piet_token}}
