### 1) JWT Token OWNER (mathias)
POST http://localhost:8180/realms/moko/protocol/openid-connect/token
Content-Type: application/x-www-form-urlencoded

grant_type = password &
client_id = session-service &
client_secret = hWzsxSaXWJtEtPkrhIoLByKFEMVuczUu &
username = mathias &
password = loginmathias &
scope = openid

> {%
    client.global.set("owner_token", response.body.access_token);
%}


### 2) JWT Token OTHER (kaj)
POST http://localhost:8180/realms/moko/protocol/openid-connect/token
Content-Type: application/x-www-form-urlencoded

grant_type = password &
client_id = session-service &
client_secret = hWzsxSaXWJtEtPkrhIoLByKFEMVuczUu &
username = kaj &
password = loginkaj &
scope = openid

> {%
    client.global.set("other_token", response.body.access_token);
%}


### 3) POST Create Lobby
POST http://localhost:8081/api/lobbies
Authorization: Bearer {{owner_token}}
Content-Type: application/json

{
  "gameId": "00000000-0000-0000-0000-000000000001",
  "maxPlayers": 4,
  "settings": {
    "type": "ticTacToe",
    "boardSize": 10
  }
}

> {%
    client.global.set("lobby_id", response.body.id);
%}


### 4) GET Lobby by ID
GET http://localhost:8081/api/lobbies/{{lobby_id}}
Authorization: Bearer {{owner_token}}


### 5) INVALID - Missing GameId
POST http://localhost:8081/api/lobbies
Authorization: Bearer {{owner_token}}
Content-Type: application/json

{
  "gameId": null,
  "maxPlayers": 4,
  "settings": {
    "type": "ticTacToe",
    "boardSize": 3
  }
}


### 6) GET Lobby - Not Found
GET http://localhost:8081/api/lobbies/11111111-1111-1111-1111-111111111111
Authorization: Bearer {{owner_token}}


### 7) CLOSE Lobby (owner only)
POST http://localhost:8081/api/lobbies/{{lobby_id}}/close
Authorization: Bearer {{owner_token}}


### 8) INVALID - Close already closed
POST http://localhost:8081/api/lobbies/{{lobby_id}}/close
Authorization: Bearer {{owner_token}}


### 9) PUT settings – Checkers update
PUT http://localhost:8081/api/lobbies/{{lobby_id}}/settings
Authorization: Bearer {{owner_token}}
Content-Type: application/json

{
  "maxPlayers": 5,
  "settings": {
    "type": "checkers",
    "boardSize": 12,
    "flyingKings": true
  }
}


### 10) INVALID - Non-owner updates settings
PUT http://localhost:8081/api/lobbies/{{lobby_id}}/settings
Authorization: Bearer {{other_token}}
Content-Type: application/json

{
  "maxPlayers": 6,
  "settings": {
    "type": "ticTacToe",
    "boardSize": 3
  }
}


### 11) GET All Lobbies
GET http://localhost:8081/api/lobbies
Authorization: Bearer {{owner_token}}


### 12) GET My Friends (needed for invites)
GET http://localhost:8083/api/friends
Authorization: Bearer {{owner_token}}


### 13) Invite PLAYER (owner invites kaj)
# bd169114-8834-4a40-983f-59b4d8bc1334 = userId van kaj
POST http://localhost:8081/api/lobbies/{{lobby_id}}/invite/bd169114-8834-4a40-983f-59b4d8bc1334
Authorization: Bearer {{owner_token}}


### 14) Bulk Invites
POST http://localhost:8081/api/lobbies/{{lobby_id}}/invite
Authorization: Bearer {{owner_token}}
Content-Type: application/json

{
  "playerIds": [
    "bd169114-8834-4a40-983f-59b4d8bc1334",
    "11111111-2222-3333-4444-555555555555"
  ]
}


### 15) OTHER checks his invites
GET http://localhost:8081/api/lobbies/invited
Authorization: Bearer {{other_token}}


### 16) Accept Invite (kaj joined lobby)
POST http://localhost:8081/api/lobbies/{{lobby_id}}/players/bd169114-8834-4a40-983f-59b4d8bc1334
Authorization: Bearer {{other_token}}


### 17) INVALID – Accept invite for another user
POST http://localhost:8081/api/lobbies/{{lobby_id}}/players/{{owner_user_id}}
Authorization: Bearer {{other_token}}


### 18) Owner removes player
DELETE http://localhost:8081/api/lobbies/{{lobby_id}}/players/bd169114-8834-4a40-983f-59b4d8bc1334
Authorization: Bearer {{owner_token}}


### 19) Bulk remove players
DELETE http://localhost:8081/api/lobbies/{{lobby_id}}/players
Authorization: Bearer {{owner_token}}
Content-Type: application/json

{
  "playerIds": [
    "{{other_user_id}}",
    "11111111-aaaa-bbbb-cccc-222222222222"
  ]
}


### 20) INVALID – Owner cannot remove himself
DELETE http://localhost:8081/api/lobbies/{{lobby_id}}/players/{{owner_user_id}}
Authorization: Bearer {{owner_token}}



########################################################
# NIEUWE FUNCTIES: READY + GAME START
########################################################

### 21) OWNER sets himself READY = true
# Vereist: owner is member van de lobby
PATCH http://localhost:8081/api/lobbies/{{lobby_id}}/players/ready
Authorization: Bearer {{owner_token}}
Content-Type: application/json

{
  "ready": true
}


### 22) OTHER (kaj) sets himself READY = true
# Gebruik het userId van kaj. Hier hardcoded of via {{other_user_id}}
PATCH http://localhost:8081/api/lobbies/{{lobby_id}}/players/ready
Authorization: Bearer {{other_token}}
Content-Type: application/json

{
  "ready": true
}


### 23) INVALID – user cannot change READY state of another player
# other probeert ready van owner te wijzigen → LobbyManagementNotAllowedException
PATCH http://localhost:8081/api/lobbies/{{lobby_id}}/players/ready
Authorization: Bearer {{other_token}}
Content-Type: application/json

{
  "ready": true
}


### 24) INVALID – Start lobby while NOT all players ready
# Run deze bv. VOOR je 21 en 22 uitvoert
POST http://localhost:8081/api/lobbies/{{lobby_id}}/start
Authorization: Bearer {{owner_token}}


### 25) VALID – Start lobby (all players ready)
# Run deze NA 21 en 22 (owner + kaj ready)
POST http://localhost:8081/api/lobbies/{{lobby_id}}/start
Authorization: Bearer {{owner_token}}

> {%
    // startedGameId komt uit LobbyResponseModel
    client.global.set("game_instance_id", response.body.startedGameId);
%}


### 26) INVALID – Non-owner cannot start lobby
POST http://localhost:8081/api/lobbies/{{lobby_id}}/start
Authorization: Bearer {{other_token}}


### 27) GET Lobby after START
# Handig om te checken:
# - status == STARTED
# - startedGameId != null
GET http://localhost:8081/api/lobbies/{{lobby_id}}
Authorization: Bearer {{owner_token}}